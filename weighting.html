<html>
  <head>
    <link href="better-things.css" rel="stylesheet">
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous">
    </script>
    <script>
$(function() {
  let questions = [];
  let currentQuestion = 0;

  function updateUrl(question, weight) {
    return "/update?index=" + question.index + "&weight=" + weight;
  }

  function thanks() {
    $('body').removeClass();
    $('body').addClass('thanks');
    $('body').empty();
    $('body').append('THANKS');
  }

  function next() {
    if (currentQuestion == questions.length - 1) {
      thanks();
      return;
    }

    currentQuestion++;
    updateQuestion();
  }

  function prev() {
    if (currentQuestion > 0) {
      currentQuestion--;
      updateQuestion();
    }
  }

  function updateQuestion() {
    $('.question-viewer').empty();
    $('.question-viewer').append(renderQuestion(questions[currentQuestion]));
    $('.question-viewer .submit').on('click', function(e) {
      $.get($(this).attr('href')).then(function() {
        next();
      });
      e.stopPropagation();
      e.preventDefault();
    });
  }

  function initialize() {
    $('body').removeClass();
    $('body').addClass('question-navigator');
    $('body').append([
        '<a class="control previous" href="#">&lt;</a>',
        '<div class="question-viewer"></div>',
        '<a class="control next" href="#">&gt;</a>'
    ].join(''));

    $('.previous').on('click', function(e) {
      e.stopPropagation();
      e.preventDefault();
      prev();
    });

    $('.next').on('click', function(e) {
      e.stopPropagation();
      e.preventDefault();
      next();
    });
  }

  function renderQuestion(question) {
    return [
      '<div class="question">',
      '  <div class="category">',
      question.category,
      '  </div>',
      '  <div class="question-text">',
      question.text,
      '  </div>',
      '  <div class="">',
      '    <div class="">',
      '      <a class="question-answer submit totally-unimportant" href="' + updateUrl(question, .2)  + '">totally unimportant</a>',
      '      <a class="question-answer submit unimportant" href="' + updateUrl(question, .5)  + '">unimportant</a>',
      '      <a class="question-answer submit no-opinion" href="' + updateUrl(question, 1)  + '">no opinion/a>',
      '      <a class="question-answer submit important" href="' + updateUrl(question, 1.5)  + '">important</a>',
      '      <a class="question-answer submit totally-important" href="' + updateUrl(question, 2)  + '">totally important</a>',
      '    </div>',
      '  </div>',
      '</div>',
    ].join('');
  }

  $.get('/questions').then(function(data) {
    questions = data;
    initialize();
    updateQuestion();
  });
});
    </script>
  </head>
  <body>
  </body>
</html>
